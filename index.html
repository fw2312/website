<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçµåŠ æ²¹ç«™ | Soul Refueling Station</title>
	<script type="module">
	  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'
	  import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'
	  import { getDatabase, ref, set, get, onValue, runTransaction } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js'
	</script>
	<script src="/config.js"></script>
    <style>
	
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }
        #language-switch {
            text-align: right;
            margin-bottom: 20px;
        }
		#like-button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 5px;
        }
        #situation-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        #spiritual-tip {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            font-size: 18px;
        }
        #next-tip {
            display: block;
            margin: 20px auto;
        }
        #custom-situation {
            margin-top: 20px;
            text-align: center;
        }
        input[type="text"] {
            padding: 5px;
            font-size: 16px;
            width: 200px;
        }
    </style>
</head>
<body>
    <div id="language-switch">
        <button onclick="switchLanguage()">English</button>
    </div>

    <h1 id="main-title">å¿ƒçµåŠ æ²¹ç«™</h1>
    <p id="intro-text">é€‰æ‹©ä½ å½“å‰çš„æƒ…å¢ƒï¼Œè·å–é€‚åˆçš„å¿ƒçµå°è´´å£«ã€‚æ¯ä¸ªç»ƒä¹ åªéœ€30ç§’ï¼Œå¸®åŠ©ä½ åœ¨å¿™ç¢Œçš„æ—¥å¸¸ä¸­æ‰¾åˆ°ç‰‡åˆ»å®é™ã€‚</p>
    
    <div id="situation-buttons">
        <button onclick="showTip('morning')">æ—©æ™¨èµ·åºŠ</button>
        <button onclick="showTip('work')">å·¥ä½œæ—¶é—´</button>
        <button onclick="showTip('break')">ä¼‘æ¯æ—¶åˆ»</button>
        <button onclick="showTip('evening')">æ™šé—´æ”¾æ¾</button>
        <button onclick="showTip('sleep')">å…¥ç¡å‰</button>
    </div>

    <div id="custom-situation">
        <h2 id="custom-title">æ·»åŠ è‡ªå®šä¹‰æƒ…å¢ƒ</h2>
        <input type="text" id="custom-situation-input" placeholder="è¾“å…¥è‡ªå®šä¹‰æƒ…å¢ƒ">
        <button onclick="addCustomSituation()" id="add-custom-btn">æ·»åŠ </button>
    </div>
	
	<div id="spiritual-tip"></div>
    <button id="like-button" onclick="likeTip()">ğŸ‘ å–œæ¬¢</button>
    <button id="next-tip" style="display: none;" onclick="showNextTip()">ä¸‹ä¸€æ¡æç¤º</button>


    <script>
        let currentLanguage = 'zh';
		let currentSituation = '';
		let currentTipId = null;
		let currentUserId = null;
        const translations = {
            zh: {
                title: "å¿ƒçµåŠ æ²¹ç«™",
                intro: "é€‰æ‹©ä½ å½“å‰çš„æƒ…å¢ƒï¼Œè·å–é€‚åˆçš„å¿ƒçµå°è´´å£«ã€‚æ¯ä¸ªç»ƒä¹ åªéœ€30ç§’ï¼Œå¸®åŠ©ä½ åœ¨å¿™ç¢Œçš„æ—¥å¸¸ä¸­æ‰¾åˆ°ç‰‡åˆ»å®é™ã€‚",
                morning: "æ—©æ™¨èµ·åºŠ",
                work: "å·¥ä½œæ—¶é—´",
                break: "ä¼‘æ¯æ—¶åˆ»",
                evening: "æ™šé—´æ”¾æ¾",
                sleep: "å…¥ç¡å‰",
                nextTip: "æ¢ä¸€ä¸ªè´´å£«",
                customTitle: "æ·»åŠ è‡ªå®šä¹‰æƒ…å¢ƒ",
                customPlaceholder: "è¾“å…¥è‡ªå®šä¹‰æƒ…å¢ƒ",
                addCustom: "æ·»åŠ ",
                switchLang: "English"
            },
            en: {
                title: "Soul Refueling Station",
                intro: "Choose your current situation to get a suitable soul tip. Each exercise takes only 30 seconds, helping you find a moment of peace in your busy day.",
                morning: "Morning Wake Up",
                work: "Work Time",
                break: "Break Time",
                evening: "Evening Relaxation",
                sleep: "Before Sleep",
                nextTip: "Next Tip",
                customTitle: "Add Custom Situation",
                customPlaceholder: "Enter custom situation",
                addCustom: "Add",
                switchLang: "ä¸­æ–‡"
            }
        };

        const tips = {
            morning: {
                zh: [
                    "æ·±å‘¼å¸ä¸‰æ¬¡ï¼Œæ„Ÿå—æ–°çš„ä¸€å¤©çš„æ´»åŠ›ã€‚",
                    "ç”¨å¾®ç¬‘å¼€å§‹è¿™ä¸€å¤©ï¼Œå¯¹è‡ªå·±è¯´å£°'æ—©å®‰'ã€‚",
                    "ç«™èµ·æ¥ä¼¸ä¸ªæ‡’è…°ï¼Œæ„Ÿå—èº«ä½“çš„æ¯ä¸ªéƒ¨åˆ†éƒ½åœ¨è‹é†’ã€‚",
                    "æƒ³è±¡é˜³å…‰æ¸©æš–åœ°ç…§åœ¨ä½ çš„è„¸ä¸Šï¼Œå”¤é†’ä½ çš„æ„Ÿå®˜ã€‚",
                    "åˆ—å‡ºä»Šå¤©ä¸‰ä»¶ä½ æœŸå¾…çš„äº‹æƒ…ã€‚",
                    "ç”¨æ„Ÿæ©çš„å¿ƒæ€å¼€å§‹æ–°çš„ä¸€å¤©ï¼Œæƒ³ä¸€ä¸ªä½ æ„Ÿæ¿€çš„äººæˆ–äº‹ã€‚",
                    "è½»è½»æŒ‰æ‘©ä½ çš„å¤ªé˜³ç©´ï¼Œå¸®åŠ©ä½ æ¸…é†’å¤´è„‘ã€‚"
                ],
                en: [
                    "Take three deep breaths, feel the energy of the new day.",
                    "Start the day with a smile, say 'Good morning' to yourself.",
                    "Stand up and stretch, feel every part of your body awakening.",
                    "Imagine warm sunlight on your face, awakening your senses.",
                    "List three things you're looking forward to today.",
                    "Start the day with gratitude, think of someone or something you're thankful for.",
                    "Gently massage your temples to help clear your mind."
                ]
            },
            work: {
                zh: [
                    "åœ¨å¼€å§‹å·¥ä½œå‰ï¼Œé—­ä¸Šçœ¼ç›ï¼Œè®¾æƒ³ä»Šå¤©æœ€ç†æƒ³çš„å·¥ä½œçŠ¶æ€ã€‚",
                    "åˆ—å‡ºä»Šå¤©æœ€é‡è¦çš„ä¸‰ä»¶äº‹ï¼Œå¸¦ç€æ„Ÿæ©çš„å¿ƒå¼€å§‹å·¥ä½œã€‚",
                    "ç”¨30ç§’æ—¶é—´ï¼Œä¸“æ³¨äºä½ çš„å‘¼å¸ï¼Œè®©è‡ªå·±è¿›å…¥å·¥ä½œçŠ¶æ€ã€‚",
                    "æƒ³è±¡ä½ æ­£åœ¨æ”€ç™»ä¸€åº§å±±ï¼Œæ¯å®Œæˆä¸€é¡¹ä»»åŠ¡å°±å‰è¿›ä¸€æ­¥ã€‚",
                    "åœ¨å·¥ä½œé—´éš™ï¼Œé—­ä¸Šçœ¼ç›ï¼Œæƒ³è±¡ä½ æ­£åœ¨å®Œæˆä¸€é¡¹é‡è¦æˆå°±ã€‚",
                    "è®¾å®šä¸€ä¸ªå°ç›®æ ‡ï¼Œå®Œæˆåå¥–åŠ±è‡ªå·±ç‰‡åˆ»çš„ä¼‘æ¯ã€‚",
                    "ç”¨æ­£é¢çš„è‡ªæˆ‘å¯¹è¯é¼“åŠ±è‡ªå·±ï¼Œå¦‚'æˆ‘èƒ½åšåˆ°è¿™ä¸ª'ã€‚"
                ],
                en: [
                    "Before starting work, close your eyes and envision your ideal work state for today.",
                    "List the three most important tasks for today, start working with a grateful heart.",
                    "Take 30 seconds to focus on your breathing, letting yourself enter a work mindset.",
                    "Imagine you're climbing a mountain, each completed task is a step forward.",
                    "During work breaks, close your eyes and imagine yourself achieving an important accomplishment.",
                    "Set a small goal, reward yourself with a moment of rest after completing it.",
                    "Use positive self-talk to encourage yourself, like 'I can do this'."
                ]
            },
            break: {
                zh: [
                    "é—­ä¸Šçœ¼ç›ï¼Œæƒ³è±¡ä½ æ­£ç«™åœ¨é˜³å…‰ä¸‹ï¼Œæ„Ÿå—æ¸©æš–ã€‚",
                    "æ…¢æ…¢å–ä¸€å£æ°´ï¼Œä¸“æ³¨æ„Ÿå—æ°´çš„æ¸©åº¦å’Œå£æ„Ÿã€‚",
                    "åšå‡ ä¸ªç®€å•çš„ä¼¸å±•åŠ¨ä½œï¼Œæ„Ÿå—èº«ä½“çš„æ”¾æ¾ã€‚",
                    "è§‚å¯Ÿå‘¨å›´ç¯å¢ƒï¼Œæ‰¾å‡ºä¸‰ç§ä¸åŒçš„é¢œè‰²ã€‚",
                    "æ·±å‘¼å¸ï¼Œæƒ³è±¡å¸å…¥å¹³é™ï¼Œå‘¼å‡ºå‹åŠ›ã€‚",
                    "ç”¨æ‰‹æŒ‡è½»è½»æŒ‰æ‘©é¢ˆéƒ¨å’Œè‚©è†€ï¼Œé‡Šæ”¾ç´§å¼ ã€‚",
                    "é—­ä¸Šçœ¼ç›ï¼Œæƒ³è±¡ä½ åœ¨ä¸€ä¸ªå®é™çš„åœ°æ–¹ï¼Œäº«å—ç‰‡åˆ»å®‰å®ã€‚"
                ],
                en: [
                    "Close your eyes, imagine standing in sunlight, feel the warmth.",
                    "Slowly take a sip of water, focus on its temperature and texture.",
                    "Do a few simple stretches, feel your body relaxing.",
                    "Observe your surroundings, find three different colors.",
                    "Take a deep breath, imagine inhaling calmness and exhaling stress.",
                    "Gently massage your neck and shoulders with your fingers, release tension.",
                    "Close your eyes, imagine you're in a peaceful place, enjoy a moment of tranquility."
                ]
            },
            evening: {
                zh: [
                    "å›æƒ³ä»Šå¤©çš„ä¸‰ä»¶å€¼å¾—æ„Ÿæ©çš„äº‹ã€‚",
                    "æ”¾æ¾å…¨èº«è‚Œè‚‰ï¼Œä»è„šåˆ°å¤´ï¼Œé€æ­¥æ„Ÿå—æ”¾æ¾ã€‚",
                    "åšå‡ ä¸ªæ·±å‘¼å¸ï¼Œæƒ³è±¡å¸å…¥å¹³é™ï¼Œå‘¼å‡ºç–²åŠ³ã€‚",
                    "æƒ³è±¡å°†ä»Šå¤©çš„å‹åŠ›å’Œçƒ¦æ¼è£…è¿›ä¸€ä¸ªç®±å­ï¼Œæš‚æ—¶æ”¾åˆ°ä¸€è¾¹ã€‚",
                    "ç”¨æ¸©å’Œçš„ç›®å…‰å›é¡¾ä»Šå¤©çš„ç»å†ï¼Œæ¥çº³æ‰€æœ‰å‘ç”Ÿçš„äº‹ã€‚",
                    "æƒ³è±¡å°†æ­£é¢èƒ½é‡ä¼ é€’ç»™æ˜å¤©çš„è‡ªå·±ã€‚",
                    "æ‰¾ä¸€ä¸ªèˆ’é€‚çš„å§¿åŠ¿ï¼Œä¸“æ³¨äºå½“ä¸‹çš„æ„Ÿå—ã€‚"
                ],
                en: [
                    "Recall three things you're grateful for today.",
                    "Relax your muscles from toe to head, feel the relaxation gradually spreading.",
                    "Take a few deep breaths, imagine inhaling calmness and exhaling fatigue.",
                    "Imagine putting today's stress and worries in a box, set it aside for now.",
                    "Review today's experiences with a gentle perspective, accept everything that happened.",
                    "Imagine passing positive energy to your future self for tomorrow.",
                    "Find a comfortable position, focus on your current feelings."
                ]
            },
            sleep: {
                zh: [
                    "æƒ³è±¡ä½ èººåœ¨ä¸€ç‰‡æ¸©æš–çš„æ²™æ»©ä¸Šï¼Œè†å¬æµ·æµªå£°ã€‚",
                    "æ…¢æ…¢æ•°ä»10åˆ°1ï¼Œæ¯æ•°ä¸€ä¸ªæ•°å­—ï¼Œæ„Ÿè§‰èº«ä½“æ›´æ²‰é‡ã€‚",
                    "å¯¹è‡ªå·±è¯´'ä»Šå¤©å·²ç»è¶³å¤Ÿå¥½äº†ï¼Œç°åœ¨æ˜¯ä¼‘æ¯çš„æ—¶å€™äº†'ã€‚",
                    "æƒ³è±¡æœ‰ä¸€é“æ¸©æŸ”çš„å…‰ä»å¤´é¡¶ç¼“ç¼“æµè¿‡å…¨èº«ï¼Œå¸¦èµ°æ‰€æœ‰ç´§å¼ ã€‚",
                    "å›æƒ³ä¸€ä¸ªç¾å¥½çš„è®°å¿†ï¼Œè®©å®ƒæˆä¸ºä½ å…¥ç¡å‰çš„æœ€åç”»é¢ã€‚",
                    "å¯¹è‡ªå·±è¯´ä¸‰é'æˆ‘å…è®¸è‡ªå·±å®Œå…¨æ”¾æ¾ï¼Œè¿›å…¥æ·±åº¦ç¡çœ 'ã€‚",
                    "æƒ³è±¡ä½ æ­£èººåœ¨ä¸€ç‰‡æŸ”è½¯çš„äº‘æœµä¸Šï¼Œæ…¢æ…¢é£˜å‘æ¢¦ä¹¡ã€‚"
                ],
                en: [
                    "Imagine lying on a warm beach, listening to the sound of waves.",
                    "Slowly count from 10 to 1, feeling your body getting heavier with each number.",
                    "Tell yourself 'Today was good enough, now it's time to rest'.",
                    "Imagine a gentle light flowing from the top of your head through your body, taking away all tension.",
                    "Recall a beautiful memory, let it be the last image before you fall asleep.",
                    "Repeat to yourself three times 'I allow myself to fully relax and enter deep sleep'.",
                    "Imagine you're lying on a soft cloud, slowly drifting off to dreamland."
                ]
            }
        };

		
// åˆå§‹åŒ– Firebase
const app = initializeApp(window.firebaseConfig);
const auth = getAuth(app);
const database = getDatabase(app);

function canWrite() {
    return window.databaseAccessLevel === 'write' || window.databaseAccessLevel === 'full';
}

function canRead() {
    return window.databaseAccessLevel === 'read' || window.databaseAccessLevel === 'full';
}

function authenticateAnonymously() {
    signInAnonymously(auth)
        .then((userCredential) => {
            currentUserId = userCredential.user.uid;
            console.log("Authenticated anonymously with user ID:", currentUserId);
            if (canRead()) {
                loadTips();
            } else {
                console.log("Reading from database is not allowed in this environment");
            }
        })
        .catch((error) => {
            console.error("Authentication error:", error);
        });
}

// ä¿®æ”¹ loadTips å‡½æ•°
function loadTips() {
    if (!canRead()) {
        console.log("Reading from database is not allowed in this environment");
        return;
    }
    const tipsRef = ref(database, 'tips');
    get(tipsRef).then((snapshot) => {
        const dbTips = snapshot.val();
        if (dbTips) {
            Object.assign(tips, dbTips);
        }
        updateUI();
    });
}


function likeTip() {
    if (!canWrite()) {
        console.log("Writing to database is not allowed in this environment");
        return;
    }
    if (!currentTipId || !currentUserId) return;

    const userLikeRef = ref(database, `user_likes/${currentUserId}/${currentTipId}`);
    const tipRef = ref(database, `tips/${currentSituation}/${currentLanguage}/${currentTipId}`);

    get(userLikeRef).then((snapshot) => {
        if (!snapshot.exists()) {
            set(userLikeRef, true);
            runTransaction(tipRef, (tip) => {
                if (tip) {
                    tip.likes = (tip.likes || 0) + 1;
                    tip.weight = (tip.weight || 1) * 1.1;
                }
                return tip;
            });
            console.log("Tip liked!");
        } else {
            console.log("You've already liked this tip.");
        }
    });
}

function switchLanguage() {
    currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
    updateUI();
}

function updateUI() {
    document.getElementById('main-title').textContent = translations[currentLanguage].title;
    document.getElementById('intro-text').textContent = translations[currentLanguage].intro;
    document.getElementById('next-tip').textContent = translations[currentLanguage].nextTip;
    document.getElementById('custom-title').textContent = translations[currentLanguage].customTitle;
    document.getElementById('custom-situation-input').placeholder = translations[currentLanguage].customPlaceholder;
    document.getElementById('add-custom-btn').textContent = translations[currentLanguage].addCustom;
    document.querySelector('#language-switch button').textContent = translations[currentLanguage].switchLang;

    const buttons = document.querySelectorAll('#situation-buttons button');
    buttons.forEach(button => {
        const situation = button.onclick.toString().match(/'(\w+)'/)[1];
        button.textContent = translations[currentLanguage][situation];
    });

    if (currentSituation) {
        showTip(currentSituation);
    }
}

function showTip(situation) {
    currentSituation = situation;
    if (!tips[situation]) return;

    const situationTips = tips[situation][currentLanguage];
    const randomIndex = Math.floor(Math.random() * situationTips.length);
    const selectedTip = situationTips[randomIndex];

    currentTipId = `${situation}_${randomIndex}`;
    const tipElement = document.getElementById('spiritual-tip');
    tipElement.textContent = selectedTip;
    document.getElementById('next-tip').style.display = 'block';
}

function showNextTip() {
    showTip(currentSituation);
}

function addCustomSituation() {
    if (!canWrite()) {
        console.log("Writing to database is not allowed in this environment");
        return;
    }
    const customSituationInput = document.getElementById('custom-situation-input');
    const customSituation = customSituationInput.value.trim();
    if (customSituation && !tips[customSituation]) {
        tips[customSituation] = {
            zh: [
                "è¿™æ˜¯æ‚¨çš„è‡ªå®šä¹‰æƒ…å¢ƒã€‚æ·±å‘¼å¸ï¼Œæ„Ÿå—å½“ä¸‹ã€‚",
                "åœ¨è¿™ä¸ªæƒ…å¢ƒä¸­ï¼Œå°è¯•æ‰¾åˆ°ä¸€ä»¶è®©æ‚¨æ„Ÿæ©çš„äº‹ç‰©ã€‚",
                "é—­ä¸Šçœ¼ç›ï¼Œæƒ³è±¡æ‚¨æ­£å¤„äºæœ€ç†æƒ³çš„çŠ¶æ€ã€‚",
                "ç”¨ä¸€ä¸ªè¯å½¢å®¹æ‚¨æ­¤åˆ»çš„æ„Ÿå—ï¼Œç„¶åæ·±å‘¼å¸ã€‚",
                "æƒ³è±¡æ‚¨æ­£åœ¨å‘ä¸€ä½æœ‹å‹æè¿°è¿™ä¸ªæƒ…å¢ƒï¼Œä¼šè¯´äº›ä»€ä¹ˆï¼Ÿ",
                "åœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œè½»è½»åœ°å¯¹è‡ªå·±è¯´ï¼š'æˆ‘å¾ˆå¥½'ã€‚",
                "è§‚å¯Ÿå‘¨å›´ï¼Œå¯»æ‰¾ä¸€ä¸ªèƒ½å¸¦ç»™æ‚¨å¹³é™çš„ç‰©ä½“æˆ–æ™¯è±¡ã€‚"
            ],
            en: [
                "This is your custom situation. Take a deep breath and feel the present moment.",
                "In this situation, try to find one thing you're grateful for.",
                "Close your eyes and imagine yourself in an ideal state.",
                "Describe your current feeling with one word, then take a deep breath.",
                "Imagine you're describing this situation to a friend. What would you say?",
                "At this moment, gently tell yourself: 'I am okay'.",
                "Observe your surroundings, find an object or scene that brings you peace."
            ]
        };
        const button = document.createElement('button');
        button.textContent = customSituation;
        button.onclick = () => showTip(customSituation);
        document.getElementById('situation-buttons').appendChild(button);
        customSituationInput.value = '';

        // å°†æ–°çš„è‡ªå®šä¹‰æƒ…å¢ƒä¿å­˜åˆ°æ•°æ®åº“
        set(ref(database, `tips/${customSituation}`), tips[customSituation]);
    }
}


// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
window.onload = function() {
    authenticateAnonymously();
};
</script>